<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Queries with purrr • CDECRetrieve</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Advanced Queries with purrr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CDECRetrieve</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/CDECRetrieve.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction_to_CDECRetrieve.html">CDEC Retrieve is now part of CRAN!</a>
    </li>
    <li>
      <a href="../articles/advanced-queries.html">Advanced Queries with purrr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Advanced Queries with purrr</h1>
                        <h4 class="author">Emanuel Rodriguez</h4>
            
            <h4 class="date">2018-05-31</h4>
      
      
      <div class="hidden name"><code>advanced-queries.Rmd</code></div>

    </div>

    
    
<p>This article outlines more advanced cases of the <code><a href="../reference/cdec_query.html">cdec_query()</a></code> function.</p>
<div id="query-multiple-stations" class="section level2">
<h2 class="hasAnchor">
<a href="#query-multiple-stations" class="anchor"></a>Query Multiple Stations</h2>
<p><code><a href="../reference/cdec_query.html">cdec_query()</a></code> takes just one instance of its arguments, so a user is <strong>not</strong> allowed to call</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="../reference/cdec_query.html">cdec_query</a></span>(<span class="dt">station =</span> <span class="kw">c</span>(<span class="st">"ccr"</span>, <span class="st">"kwk"</span>), <span class="dt">dur_code =</span> <span class="st">"h"</span>, <span class="dt">sensor_num =</span> <span class="st">"25"</span>)</a></code></pre></div>
<p>but we can implement this same query using higher level functions.</p>
<div id="using-purrr" class="section level3">
<h3 class="hasAnchor">
<a href="#using-purrr" class="anchor"></a>Using purrr</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(CDECRetrieve)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">stations_of_interest &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"kwk"</span>, <span class="st">"ccr"</span>, <span class="st">"bsf"</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"># 'map' through the stations of interest and apply them to the function</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map</a></span>(stations_of_interest, <span class="cf">function</span>(s) {</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  <span class="kw"><a href="../reference/cdec_query.html">cdec_query</a></span>(<span class="dt">station =</span> s, <span class="dt">sensor_num =</span> <span class="st">"25"</span>, <span class="dt">dur_code =</span> <span class="st">"h"</span>)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">})</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; # A tibble: 73 x 5</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt;    agency_cd location_id datetime            parameter_cd parameter_value</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt;  1 CDEC      KWK         2018-05-29 00:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt;  2 CDEC      KWK         2018-05-29 01:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt;  3 CDEC      KWK         2018-05-29 02:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt;  4 CDEC      KWK         2018-05-29 03:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt;  5 CDEC      KWK         2018-05-29 04:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt;  6 CDEC      KWK         2018-05-29 05:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt;  7 CDEC      KWK         2018-05-29 06:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt;  8 CDEC      KWK         2018-05-29 07:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt;  9 CDEC      KWK         2018-05-29 08:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; 10 CDEC      KWK         2018-05-29 09:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; # ... with 63 more rows</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co">#&gt; # A tibble: 73 x 5</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="co">#&gt;    agency_cd location_id datetime            parameter_cd parameter_value</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="co">#&gt;  1 CDEC      CCR         2018-05-29 00:00:00 25                      52.6</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="co">#&gt;  2 CDEC      CCR         2018-05-29 01:00:00 25                      52.4</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="co">#&gt;  3 CDEC      CCR         2018-05-29 02:00:00 25                      52.2</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="co">#&gt;  4 CDEC      CCR         2018-05-29 03:00:00 25                      52.1</span></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="co">#&gt;  5 CDEC      CCR         2018-05-29 04:00:00 25                      52.0</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="co">#&gt;  6 CDEC      CCR         2018-05-29 05:00:00 25                      52.0</span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="co">#&gt;  7 CDEC      CCR         2018-05-29 06:00:00 25                      51.9</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"><span class="co">#&gt;  8 CDEC      CCR         2018-05-29 07:00:00 25                      52.0</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="co">#&gt;  9 CDEC      CCR         2018-05-29 08:00:00 25                      52.2</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="co">#&gt; 10 CDEC      CCR         2018-05-29 09:00:00 25                      52.6</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="co">#&gt; # ... with 63 more rows</span></a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43"><span class="co">#&gt; # A tibble: 73 x 5</span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44"><span class="co">#&gt;    agency_cd location_id datetime            parameter_cd parameter_value</span></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-46" data-line-number="46"><span class="co">#&gt;  1 CDEC      BSF         2018-05-29 00:00:00 25                      55.4</span></a>
<a class="sourceLine" id="cb2-47" data-line-number="47"><span class="co">#&gt;  2 CDEC      BSF         2018-05-29 01:00:00 25                      54.8</span></a>
<a class="sourceLine" id="cb2-48" data-line-number="48"><span class="co">#&gt;  3 CDEC      BSF         2018-05-29 02:00:00 25                      54.4</span></a>
<a class="sourceLine" id="cb2-49" data-line-number="49"><span class="co">#&gt;  4 CDEC      BSF         2018-05-29 03:00:00 25                      54.0</span></a>
<a class="sourceLine" id="cb2-50" data-line-number="50"><span class="co">#&gt;  5 CDEC      BSF         2018-05-29 04:00:00 25                      53.7</span></a>
<a class="sourceLine" id="cb2-51" data-line-number="51"><span class="co">#&gt;  6 CDEC      BSF         2018-05-29 05:00:00 25                      53.4</span></a>
<a class="sourceLine" id="cb2-52" data-line-number="52"><span class="co">#&gt;  7 CDEC      BSF         2018-05-29 06:00:00 25                      53.3</span></a>
<a class="sourceLine" id="cb2-53" data-line-number="53"><span class="co">#&gt;  8 CDEC      BSF         2018-05-29 07:00:00 25                      53.1</span></a>
<a class="sourceLine" id="cb2-54" data-line-number="54"><span class="co">#&gt;  9 CDEC      BSF         2018-05-29 08:00:00 25                      53.1</span></a>
<a class="sourceLine" id="cb2-55" data-line-number="55"><span class="co">#&gt; 10 CDEC      BSF         2018-05-29 09:00:00 25                      53.4</span></a>
<a class="sourceLine" id="cb2-56" data-line-number="56"><span class="co">#&gt; # ... with 63 more rows</span></a></code></pre></div>
<p>Using <code>map</code> will return the call to <code>cdec_query</code>, returning each as an element of a list. This is ok, but we know that the query will return a data.frame with the same structure for each so we can combine these to get one dataframe.</p>
<p>This can be done by using a variant of the <code>map</code> function, <code><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map_df()</a></code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">temp_data &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map_df</a></span>(stations_of_interest, <span class="cf">function</span>(s) {</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="kw"><a href="../reference/cdec_query.html">cdec_query</a></span>(<span class="dt">station =</span> s, <span class="dt">sensor_num =</span> <span class="st">"25"</span>, <span class="dt">dur_code =</span> <span class="st">"h"</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">})</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw">head</span>(temp_data)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;   agency_cd location_id datetime            parameter_cd parameter_value</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; 1 CDEC      KWK         2018-05-29 00:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; 2 CDEC      KWK         2018-05-29 01:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; 3 CDEC      KWK         2018-05-29 02:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; 4 CDEC      KWK         2018-05-29 03:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; 5 CDEC      KWK         2018-05-29 04:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; 6 CDEC      KWK         2018-05-29 05:00:00 25                      51.8</span></a></code></pre></div>
<p>and now we can visualize these,</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">temp_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(datetime, parameter_value, <span class="dt">color=</span>location_id)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>()</a></code></pre></div>
<p><img src="advanced-queries_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Great!</p>
<p>We can still improve this by using some shortcut features in purrr. Namely we can shorten the <code>function</code> part of <code>map_df</code> using the <code>~</code> shortcut.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># here ~ tells map that this a function, and to interpret '.' as a value</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co"># being passed from the `stations_of_interest`</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map_df</a></span>(stations_of_interest, <span class="op">~</span><span class="kw"><a href="../reference/cdec_query.html">cdec_query</a></span>(., <span class="st">"25"</span>, <span class="st">"h"</span>))</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; # A tibble: 219 x 5</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt;    agency_cd location_id datetime            parameter_cd parameter_value</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;  1 CDEC      KWK         2018-05-29 00:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;  2 CDEC      KWK         2018-05-29 01:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  3 CDEC      KWK         2018-05-29 02:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;  4 CDEC      KWK         2018-05-29 03:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt;  5 CDEC      KWK         2018-05-29 04:00:00 25                      51.7</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;  6 CDEC      KWK         2018-05-29 05:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt;  7 CDEC      KWK         2018-05-29 06:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt;  8 CDEC      KWK         2018-05-29 07:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt;  9 CDEC      KWK         2018-05-29 08:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; 10 CDEC      KWK         2018-05-29 09:00:00 25                      51.8</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; # ... with 209 more rows</span></a></code></pre></div>
</div>
</div>
<div id="combination-of-multiple-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#combination-of-multiple-arguments" class="anchor"></a>Combination of multiple Arguments</h2>
<p>The above section gave us the basic recipe for playing with multiple stations (and multiple of any other arguments), in this section we expand this to tackle multiple combinations of each. There are many ways to accomplish this, but I outline a recipe that has worked well for me.</p>
<p>First lets gather all the pieces we want to have changing,</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">stations_of_interest &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"ccr"</span>, <span class="st">"kwk"</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">sensors_of_interest &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"25"</span>, <span class="st">"1"</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">dur_code =<span class="st"> "h"</span></a></code></pre></div>
<p>Now we can use yet another variant of <code>map</code>, <code>pmap_df</code> to pass in an arbitrary number of arguments,</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map2">pmap_df</a></span>(<span class="kw">list</span>(stations_of_interest, </a>
<a class="sourceLine" id="cb7-2" data-line-number="2">             sensors_of_interest, </a>
<a class="sourceLine" id="cb7-3" data-line-number="3">             dur_code), <span class="op">~</span><span class="kw"><a href="../reference/cdec_query.html">cdec_query</a></span>(<span class="dt">station =</span> ..<span class="dv">1</span>, <span class="dt">sensor_num =</span> ..<span class="dv">2</span>, <span class="dt">dur_code =</span> ..<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; # A tibble: 146 x 5</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;    agency_cd location_id datetime            parameter_cd parameter_value</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  1 CDEC      CCR         2018-05-29 00:00:00 25                      52.6</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  2 CDEC      CCR         2018-05-29 01:00:00 25                      52.4</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  3 CDEC      CCR         2018-05-29 02:00:00 25                      52.2</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  4 CDEC      CCR         2018-05-29 03:00:00 25                      52.1</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  5 CDEC      CCR         2018-05-29 04:00:00 25                      52.0</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  6 CDEC      CCR         2018-05-29 05:00:00 25                      52.0</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;  7 CDEC      CCR         2018-05-29 06:00:00 25                      51.9</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;  8 CDEC      CCR         2018-05-29 07:00:00 25                      52.0</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;  9 CDEC      CCR         2018-05-29 08:00:00 25                      52.2</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; 10 CDEC      CCR         2018-05-29 09:00:00 25                      52.6</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; # ... with 136 more rows</span></a></code></pre></div>
<p>Here we use <code>..1, ..2, ..3</code> to refer to the first, second and third elements of the list, we can grow this any number of arguments.</p>
<div id="making-a-custom-function" class="section level4">
<h4 class="hasAnchor">
<a href="#making-a-custom-function" class="anchor"></a>Making a custom function</h4>
<p>In the above we don’t really change <code>dur_code</code> but we still need to supply it into the function. We can save some time by creating a function out of <code><a href="../reference/cdec_query.html">cdec_query()</a></code>, using <code><a href="http://www.rdocumentation.org/packages/purrr/topics/partial">purrr::partial()</a></code>, we can create a function that takes two arguments and has “dur_code” fixed to “h”. This allow us to use <code>map2_df</code> instead of <code>pmap_df</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">cdec_query_hourly &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/partial">partial</a></span>(cdec_query, <span class="dt">dur_code=</span><span class="st">"h"</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co"># we only have to supply two arguments</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map2">map2_df</a></span>(stations_of_interest, sensors_of_interest, </a>
<a class="sourceLine" id="cb8-5" data-line-number="5">        <span class="op">~</span><span class="kw">cdec_query_hourly</span>(<span class="dt">station=</span>.x, <span class="dt">sensor_num=</span>.y))</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; # A tibble: 146 x 5</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt;    agency_cd location_id datetime            parameter_cd parameter_value</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;  1 CDEC      CCR         2018-05-29 00:00:00 25                      52.6</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;  2 CDEC      CCR         2018-05-29 01:00:00 25                      52.4</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;  3 CDEC      CCR         2018-05-29 02:00:00 25                      52.2</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;  4 CDEC      CCR         2018-05-29 03:00:00 25                      52.1</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;  5 CDEC      CCR         2018-05-29 04:00:00 25                      52.0</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;  6 CDEC      CCR         2018-05-29 05:00:00 25                      52.0</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt;  7 CDEC      CCR         2018-05-29 06:00:00 25                      51.9</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt;  8 CDEC      CCR         2018-05-29 07:00:00 25                      52.0</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;  9 CDEC      CCR         2018-05-29 08:00:00 25                      52.2</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; 10 CDEC      CCR         2018-05-29 09:00:00 25                      52.6</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; # ... with 136 more rows</span></a></code></pre></div>
</div>
<div id="all-combinations-of-arguments" class="section level3">
<h3 class="hasAnchor">
<a href="#all-combinations-of-arguments" class="anchor"></a>All combinations of arguments</h3>
<p>Here is a way to query for a set of all combination of inputs for a given set of stations and sensors.</p>
<p><strong>Note</strong>: you need confirm these combinations make sense to query.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">stations_of_interest &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"bsf"</span>, <span class="st">"kwk"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">sensors_of_interest &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"25"</span>, <span class="st">"27"</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">dur_code &lt;-<span class="st"> "h"</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co"># data frame of all combinations</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">ins &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">x=</span>stations_of_interest, </a>
<a class="sourceLine" id="cb9-7" data-line-number="7">                   <span class="dt">y=</span>sensors_of_interest, </a>
<a class="sourceLine" id="cb9-8" data-line-number="8">                   <span class="dt">z=</span>dur_code, </a>
<a class="sourceLine" id="cb9-9" data-line-number="9">                   <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb9-10" data-line-number="10"></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">temp_and_turb &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map2">pmap_df</a></span>(<span class="kw">list</span>(ins<span class="op">$</span>x, ins<span class="op">$</span>y, ins<span class="op">$</span>z), <span class="op">~</span><span class="kw"><a href="../reference/cdec_query.html">cdec_query</a></span>(..<span class="dv">1</span>, ..<span class="dv">2</span>, ..<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;   X1 = col_character(),</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;   X2 = col_character(),</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt;   X3 = col_integer(),</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt;   X4 = col_character(),</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt;   X5 = col_character(),</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt;   X6 = col_character(),</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt;   X7 = col_character(),</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt;   X8 = col_character()</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="co">#&gt;   X1 = col_character(),</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="co">#&gt;   X2 = col_character(),</span></a>
<a class="sourceLine" id="cb9-28" data-line-number="28"><span class="co">#&gt;   X3 = col_integer(),</span></a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="co">#&gt;   X4 = col_character(),</span></a>
<a class="sourceLine" id="cb9-30" data-line-number="30"><span class="co">#&gt;   X5 = col_character(),</span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31"><span class="co">#&gt;   X6 = col_character(),</span></a>
<a class="sourceLine" id="cb9-32" data-line-number="32"><span class="co">#&gt;   X7 = col_character(),</span></a>
<a class="sourceLine" id="cb9-33" data-line-number="33"><span class="co">#&gt;   X8 = col_character()</span></a>
<a class="sourceLine" id="cb9-34" data-line-number="34"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb9-35" data-line-number="35"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb9-36" data-line-number="36"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb9-37" data-line-number="37"><span class="co">#&gt;   X1 = col_character(),</span></a>
<a class="sourceLine" id="cb9-38" data-line-number="38"><span class="co">#&gt;   X2 = col_character(),</span></a>
<a class="sourceLine" id="cb9-39" data-line-number="39"><span class="co">#&gt;   X3 = col_integer(),</span></a>
<a class="sourceLine" id="cb9-40" data-line-number="40"><span class="co">#&gt;   X4 = col_character(),</span></a>
<a class="sourceLine" id="cb9-41" data-line-number="41"><span class="co">#&gt;   X5 = col_character(),</span></a>
<a class="sourceLine" id="cb9-42" data-line-number="42"><span class="co">#&gt;   X6 = col_character(),</span></a>
<a class="sourceLine" id="cb9-43" data-line-number="43"><span class="co">#&gt;   X7 = col_character(),</span></a>
<a class="sourceLine" id="cb9-44" data-line-number="44"><span class="co">#&gt;   X8 = col_character()</span></a>
<a class="sourceLine" id="cb9-45" data-line-number="45"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb9-46" data-line-number="46"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb9-47" data-line-number="47"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb9-48" data-line-number="48"><span class="co">#&gt;   X1 = col_character(),</span></a>
<a class="sourceLine" id="cb9-49" data-line-number="49"><span class="co">#&gt;   X2 = col_character(),</span></a>
<a class="sourceLine" id="cb9-50" data-line-number="50"><span class="co">#&gt;   X3 = col_integer(),</span></a>
<a class="sourceLine" id="cb9-51" data-line-number="51"><span class="co">#&gt;   X4 = col_character(),</span></a>
<a class="sourceLine" id="cb9-52" data-line-number="52"><span class="co">#&gt;   X5 = col_character(),</span></a>
<a class="sourceLine" id="cb9-53" data-line-number="53"><span class="co">#&gt;   X6 = col_character(),</span></a>
<a class="sourceLine" id="cb9-54" data-line-number="54"><span class="co">#&gt;   X7 = col_character(),</span></a>
<a class="sourceLine" id="cb9-55" data-line-number="55"><span class="co">#&gt;   X8 = col_character()</span></a>
<a class="sourceLine" id="cb9-56" data-line-number="56"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb9-57" data-line-number="57"></a>
<a class="sourceLine" id="cb9-58" data-line-number="58"><span class="kw">head</span>(temp_and_turb)</a>
<a class="sourceLine" id="cb9-59" data-line-number="59"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb9-60" data-line-number="60"><span class="co">#&gt;   agency_cd location_id datetime            parameter_cd parameter_value</span></a>
<a class="sourceLine" id="cb9-61" data-line-number="61"><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-62" data-line-number="62"><span class="co">#&gt; 1 CDEC      BSF         2018-05-29 00:00:00 25                      55.4</span></a>
<a class="sourceLine" id="cb9-63" data-line-number="63"><span class="co">#&gt; 2 CDEC      BSF         2018-05-29 01:00:00 25                      54.8</span></a>
<a class="sourceLine" id="cb9-64" data-line-number="64"><span class="co">#&gt; 3 CDEC      BSF         2018-05-29 02:00:00 25                      54.4</span></a>
<a class="sourceLine" id="cb9-65" data-line-number="65"><span class="co">#&gt; 4 CDEC      BSF         2018-05-29 03:00:00 25                      54.0</span></a>
<a class="sourceLine" id="cb9-66" data-line-number="66"><span class="co">#&gt; 5 CDEC      BSF         2018-05-29 04:00:00 25                      53.7</span></a>
<a class="sourceLine" id="cb9-67" data-line-number="67"><span class="co">#&gt; 6 CDEC      BSF         2018-05-29 05:00:00 25                      53.4</span></a></code></pre></div>
<p>and now we can visualize these</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">param_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"25"</span> =<span class="st"> "Temperature (F)"</span>, <span class="st">"27"</span> =<span class="st"> "Turbidity (NTU)"</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">temp_and_turb <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(datetime, parameter_value, <span class="dt">color=</span>location_id)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_grid">facet_grid</a></span>(. <span class="op">~</span><span class="st"> </span>param_names[parameter_cd], <span class="dt">scales =</span> <span class="st">"free"</span>)</a></code></pre></div>
<p><img src="advanced-queries_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#query-multiple-stations">Query Multiple Stations</a></li>
      <li><a href="#combination-of-multiple-arguments">Combination of multiple Arguments</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Emanuel Rodriguez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
