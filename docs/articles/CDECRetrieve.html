<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started • CDECRetrieve</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Getting Started">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CDECRetrieve</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/CDECRetrieve.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction_to_CDECRetrieve.html">CDEC Retrieve is now part of CRAN!</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting Started</h1>
                        <h4 class="author">Emanuel Rodriguez</h4>
            
            <h4 class="date">2018-05-09</h4>
      
      
      <div class="hidden name"><code>CDECRetrieve.Rmd</code></div>

    </div>

    
    
<div id="install" class="section level1">
<h1 class="hasAnchor">
<a href="#install" class="anchor"></a>Install</h1>
<p>You can install CDECRetrieve the usual way,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for stable version</span>
<span class="kw">install.packages</span>(<span class="st">"CDECRetrieve"</span>)

<span class="co"># for development version</span>
devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"flowwest/CDECRetrieve"</span>)</code></pre></div>
</div>
<div id="intro" class="section level1">
<h1 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h1>
<p>The goal for CDECRetrieve is to create a workflow for R users using CDEC data, we believe that a well defined workflow is easier to automate and less prone to error (or easier to catch errors). In order to do this we create “services” out of different endpoints available through the CDEC site. A lot ideas in developing the package came from using <code>dataRetrieval</code> from USGS and the NOAA CDO api.</p>
</div>
<div id="exploring-locations" class="section level1">
<h1 class="hasAnchor">
<a href="#exploring-locations" class="anchor"></a>Exploring Locations</h1>
<p>We start by first exploring locations of interest. The CDEC site provides a web form with a lot of options,</p>
<div class="figure">
<img src="cdec-station-search.png" alt="cdec station search"><p class="caption">cdec station search</p>
</div>
<p>The pakcage exposes this functionallity through <code><a href="../reference/cdec_stations.html">cdec_stations()</a></code>. Although it doesn’t (currently) map all options in the web form it does so for the most used, namely, station id, nearby city, river basin, hydro area and county. At least one of the parameters must be supplied, and combination of these can be supplied to refine the search.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(CDECRetrieve)

<span class="kw"><a href="../reference/cdec_stations.html">cdec_stations</a></span>(<span class="dt">station_id =</span> <span class="st">"kwk"</span>) <span class="co"># return metadata for KWK</span>
<span class="co">#&gt; # A tibble: 1 x 9</span>
<span class="co">#&gt;   station_id name          river_basin county longitude latitude elevation</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt; 1 kwk        sacramento r… sacramento… shasta     -122.     40.6 596 &amp;nbsp</span>
<span class="co">#&gt; # ... with 2 more variables: operator &lt;chr&gt;, state &lt;chr&gt;</span>

<span class="co"># show all locations near san francisco, this returns a set of </span>
<span class="co"># CDEC station that are near San Francisco</span>
<span class="kw"><a href="../reference/cdec_stations.html">cdec_stations</a></span>(<span class="dt">nearby_city =</span> <span class="st">"san francisco"</span>)
<span class="co">#&gt; # A tibble: 3 x 9</span>
<span class="co">#&gt;   station_id name        river_basin county   longitude latitude elevation</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt; 1 sfn        san franci… sf bay      san fra…     -122.     37.8 150 &amp;nbsp</span>
<span class="co">#&gt; 2 cx2        daily x2 c… sf bay      san fra…     -122.     37.8 0 &amp;nbsp  </span>
<span class="co">#&gt; 3 ggt        golden gate sf bay      san fra…     -122.     37.8 0 &amp;nbsp  </span>
<span class="co">#&gt; # ... with 2 more variables: operator &lt;chr&gt;, state &lt;chr&gt;</span>

<span class="co"># show all location in the sf bay river basin</span>
<span class="kw"><a href="../reference/cdec_stations.html">cdec_stations</a></span>(<span class="dt">river_basin =</span> <span class="st">"sf bay"</span>)
<span class="co">#&gt; # A tibble: 25 x 9</span>
<span class="co">#&gt;    station_id name        river_basin county  longitude latitude elevation</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt;  1 mrh        marsh cree… sf bay      contra…     -122.     37.9 740 &amp;nbsp</span>
<span class="co">#&gt;  2 sfn        san franci… sf bay      san fr…     -122.     37.8 150 &amp;nbsp</span>
<span class="co">#&gt;  3 lsm        los medonos sf bay      contra…     -122.     38.0 130 &amp;nbsp</span>
<span class="co">#&gt;  4 dvb        danville l… sf bay      contra…     -122.     37.8 364 &amp;nbsp</span>
<span class="co">#&gt;  5 snn        san andreas sf bay      san ma…     -122.     37.6 456 &amp;nbsp</span>
<span class="co">#&gt;  6 umn        mt. umunhu… sf bay      santa …     -122.     37.2 3090 &amp;nb…</span>
<span class="co">#&gt;  7 rhl        richmond c… sf bay      contra…     -122.     37.9 55 &amp;nbsp </span>
<span class="co">#&gt;  8 mas        main ave d… sf bay      santa …    -1000.    100.0 9999     </span>
<span class="co">#&gt;  9 cx2        daily x2 c… sf bay      san fr…     -122.     37.8 0 &amp;nbsp  </span>
<span class="co">#&gt; 10 ccp        concord pa… sf bay      contra…     -122.     38.0 558 &amp;nbsp</span>
<span class="co">#&gt; # ... with 15 more rows, and 2 more variables: operator &lt;chr&gt;, state &lt;chr&gt;</span>

<span class="co"># show all station in Tehama county</span>
<span class="kw"><a href="../reference/cdec_stations.html">cdec_stations</a></span>(<span class="dt">county =</span> <span class="st">"tehama"</span>)
<span class="co">#&gt; # A tibble: 45 x 9</span>
<span class="co">#&gt;    station_id name         river_basin county longitude latitude elevation</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt;  1 teh        sacramento … sacramento… tehama     -122.     40.0 213 &amp;nbsp</span>
<span class="co">#&gt;  2 crg        corning air… sacramento… tehama     -122.     39.9 294 &amp;nbsp</span>
<span class="co">#&gt;  3 sbb        sacramento … sacto vly … tehama     -122.     40.3 186 &amp;nbsp</span>
<span class="co">#&gt;  4 btw        nf battle c… sacramento… tehama     -122.     40.4 1200 &amp;nb…</span>
<span class="co">#&gt;  5 lgs        log spring   sacto vly … tehama     -123.     39.8 5100 &amp;nb…</span>
<span class="co">#&gt;  6 atp        anthony peak stony cr    tehama     -123.     39.8 6200 &amp;nb…</span>
<span class="co">#&gt;  7 bnd        sacramento … sacramento… tehama     -122.     40.3 286 &amp;nbsp</span>
<span class="co">#&gt;  8 dvr        davis ranch  cottonwood… tehama     -122.     40.4 550 &amp;nbsp</span>
<span class="co">#&gt;  9 sh1        sheet iron … sacramento… tehama     -123.     39.5 6500 &amp;nb…</span>
<span class="co">#&gt; 10 bas        south fork … sacramento… tehama     -122.     40.4 997 &amp;nbsp</span>
<span class="co">#&gt; # ... with 35 more rows, and 2 more variables: operator &lt;chr&gt;, state &lt;chr&gt;</span></code></pre></div>
<p>Since we are simply exploring for locations of interest, it may be useful to map these for visual inspection. CDECRetrieve provides a simple function to do exactly this <code><a href="../reference/map_stations.html">map_stations()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(magrittr)
<span class="kw">library</span>(leaflet)

<span class="kw"><a href="../reference/cdec_stations.html">cdec_stations</a></span>(<span class="dt">county =</span> <span class="st">"tehama"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/map_stations.html">map_stations</a></span>()</code></pre></div>
<p>The same can be done with leaflet functions</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cdec_stations.html">cdec_stations</a></span>(<span class="dt">county =</span> <span class="st">"tehama"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/leaflet">leaflet</a></span>(d) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/map-layers">addTiles</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/map-layers">addCircleMarkers</a></span>(<span class="dt">label=</span><span class="op">~</span>station_id) <span class="co">#psk is way off here </span></code></pre></div>
</div>
<div id="exploring-datasets-within-a-station" class="section level1">
<h1 class="hasAnchor">
<a href="#exploring-datasets-within-a-station" class="anchor"></a>Exploring Datasets within a Station</h1>
<p>After exploring stations in a desired location. We can start focusing on the datasets available at the locations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">station &lt;-<span class="st"> "sha"</span>
<span class="kw"><a href="../reference/cdec_datasets.html">cdec_datasets</a></span>(<span class="st">"sha"</span>)
<span class="co">#&gt; # A tibble: 21 x 6</span>
<span class="co">#&gt;    sensor_number sensor_name   sensor_units duration start      end       </span>
<span class="co">#&gt;            &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;    &lt;date&gt;     &lt;date&gt;    </span>
<span class="co">#&gt;  1             2 precipitatio… inches       daily    2003-10-01 2018-05-09</span>
<span class="co">#&gt;  2             2 precipitatio… inches       monthly  1953-10-01 2018-05-09</span>
<span class="co">#&gt;  3             6 reservoir el… feet         daily    1985-01-01 2018-05-09</span>
<span class="co">#&gt;  4             6 reservoir el… feet         hourly   1993-12-09 2018-05-09</span>
<span class="co">#&gt;  5             8 full natural… cfs          daily    1987-05-31 2018-05-09</span>
<span class="co">#&gt;  6            15 reservoir st… af           daily    1985-01-01 2018-05-09</span>
<span class="co">#&gt;  7            15 reservoir st… af           hourly   1994-06-24 2018-05-09</span>
<span class="co">#&gt;  8            15 reservoir st… af           monthly  1953-10-01 2018-05-09</span>
<span class="co">#&gt;  9            22 reservoir st… af           daily    1993-10-03 2018-05-09</span>
<span class="co">#&gt; 10            23 reservoir ou… cfs          daily    1987-01-05 2018-05-09</span>
<span class="co">#&gt; # ... with 11 more rows</span></code></pre></div>
<p>Since all of these functions return a tidy dataframe we can make use of the <code>dplyr</code> to filter, mutate and explore. Here we look for datasets in Shasta that report a storage</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(magrittr)

<span class="kw"><a href="../reference/cdec_datasets.html">cdec_datasets</a></span>(<span class="st">"sha"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">grepl</span>(<span class="st">"storage"</span>, sensor_name))
<span class="co">#&gt; # A tibble: 5 x 6</span>
<span class="co">#&gt;   sensor_number sensor_name    sensor_units duration start      end       </span>
<span class="co">#&gt;           &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;    &lt;date&gt;     &lt;date&gt;    </span>
<span class="co">#&gt; 1            15 reservoir sto… af           daily    1985-01-01 2018-05-09</span>
<span class="co">#&gt; 2            15 reservoir sto… af           hourly   1994-06-24 2018-05-09</span>
<span class="co">#&gt; 3            15 reservoir sto… af           monthly  1953-10-01 2018-05-09</span>
<span class="co">#&gt; 4            22 reservoir sto… af           daily    1993-10-03 2018-05-09</span>
<span class="co">#&gt; 5            94 reservoir top… af           daily    2000-10-24 2018-05-09</span></code></pre></div>
<p>Take note of the sensor number, and duration, these will be needed for querying data in the next section.</p>
</div>
<div id="query-data" class="section level1">
<h1 class="hasAnchor">
<a href="#query-data" class="anchor"></a>Query Data</h1>
<p>Now that we have a location, parameter of interest and duration we can start to query for actual data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sha_storage_daily &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cdec_query.html">cdec_query</a></span>(<span class="dt">station =</span> <span class="st">"sha"</span>, <span class="dt">sensor_num =</span> <span class="st">"15"</span>, 
                                <span class="dt">dur_code =</span> <span class="st">"d"</span>, <span class="dt">start_date =</span> <span class="st">"2018-01-01"</span>, 
                                <span class="dt">end_date =</span> <span class="kw">Sys.Date</span>())

sha_storage_daily
<span class="co">#&gt; # A tibble: 129 x 5</span>
<span class="co">#&gt;    agency_cd location_id datetime            parameter_cd parameter_value</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;                  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 CDEC      SHA         2018-01-01 00:00:00 15                  3203249.</span>
<span class="co">#&gt;  2 CDEC      SHA         2018-01-02 00:00:00 15                  3202064.</span>
<span class="co">#&gt;  3 CDEC      SHA         2018-01-03 00:00:00 15                  3203723.</span>
<span class="co">#&gt;  4 CDEC      SHA         2018-01-04 00:00:00 15                  3206566.</span>
<span class="co">#&gt;  5 CDEC      SHA         2018-01-05 00:00:00 15                  3210358.</span>
<span class="co">#&gt;  6 CDEC      SHA         2018-01-06 00:00:00 15                  3215097.</span>
<span class="co">#&gt;  7 CDEC      SHA         2018-01-07 00:00:00 15                  3217003.</span>
<span class="co">#&gt;  8 CDEC      SHA         2018-01-08 00:00:00 15                  3229391.</span>
<span class="co">#&gt;  9 CDEC      SHA         2018-01-09 00:00:00 15                  3237014.</span>
<span class="co">#&gt; 10 CDEC      SHA         2018-01-10 00:00:00 15                  3242032.</span>
<span class="co">#&gt; # ... with 119 more rows</span></code></pre></div>
<p>Once again the the data is in a tidy form.</p>
<div id="plot" class="section level3">
<h3 class="hasAnchor">
<a href="#plot" class="anchor"></a>Plot</h3>
<p>We can plot with ggplot2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

sha_storage_daily <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(datetime, parameter_value)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>()</code></pre></div>
<p><img src="CDECRetrieve_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#install">Install</a></li>
      <li><a href="#intro">Intro</a></li>
      <li><a href="#exploring-locations">Exploring Locations</a></li>
      <li><a href="#exploring-datasets-within-a-station">Exploring Datasets within a Station</a></li>
      <li><a href="#query-data">Query Data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Emanuel Rodriguez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
